(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{310:(e,t,a)=>{Promise.resolve().then(a.bind(a,7513))},4861:(e,t,a)=>{"use strict";a.d(t,{A:()=>u,AuthProvider:()=>m});var s=a(5155),r=a(2115);let n=(0,r.createContext)(void 0),i=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30,s=new Date;s.setTime(s.getTime()+864e5*a),document.cookie="".concat(e,"=").concat(t,";expires=").concat(s.toUTCString(),";path=/")},o=e=>{let t=e+"=",a=document.cookie.split(";");for(let e=0;e<a.length;e++){let s=a[e];for(;" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return s.substring(t.length,s.length)}return null},l=e=>{document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;")},c=async(e,t)=>{try{await fetch("/api/players/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerId:t,name:e,joinedAt:Date.now(),isOnline:!0})})}catch(e){console.error("Failed to register player:",e)}},d=async(e,t)=>{try{await fetch("/api/players/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerId:e,isOnline:t,lastSeen:Date.now()})})}catch(e){console.error("Failed to update player status:",e)}};function m(e){let{children:t}=e,[a,m]=(0,r.useState)(null),[u,g]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=o("guestUser"),t=localStorage.getItem("guestUser"),a=null;if(e)try{a=JSON.parse(e)}catch(e){console.error("Error parsing cookie user:",e)}else if(t)try{a=JSON.parse(t),i("guestUser",t),localStorage.removeItem("guestUser")}catch(e){console.error("Error parsing localStorage user:",e)}if(a&&a.name){m(a);let e=o("lastRegistration"),t=Date.now();(!e||t-parseInt(e)>3e5)&&(c(a.name,a.id),i("lastRegistration",t.toString()))}g(!1)},[]),(0,r.useEffect)(()=>{if(!a)return;let e=0,t=()=>{let e=!document.hidden;d(a.id,e)},s=()=>{d(a.id,!1)};document.addEventListener("visibilitychange",t),window.addEventListener("beforeunload",s);let r=setInterval(()=>{if(!document.hidden){let t=Date.now();t-e>=3e4&&(e=t,d(a.id,!0))}},12e4);return()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("beforeunload",s),clearInterval(r)}},[a]),(0,s.jsx)(n.Provider,{value:{user:a,loading:u,signInAsGuest:e=>{let t={id:Math.random().toString(36).substr(2,9),name:e.trim(),email:"guest@aspade.online",isGuest:!0};m(t);let a=JSON.stringify(t);i("guestUser",a),localStorage.setItem("guestUser",a),c(t.name,t.id)},signOut:()=>{a&&d(a.id,!1),m(null),l("guestUser"),localStorage.removeItem("guestUser")}},children:t})}function u(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7513:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var s=a(5155),r=a(2115),n=a(5695),i=a(7168),o=a(8482),l=a(9852),c=a(2714),d=a(9840),m=a(8145),u=a(3311),g=a(7580),h=a(1154),p=a(5657),x=a(1007),f=a(3904),y=a(4186),b=a(5690),v=a(8186),N=a(4861),j=a(3580),w=a(1886);function S(){let[e,t]=(0,r.useState)(""),[a,S]=(0,r.useState)(!1),[A,C]=(0,r.useState)("Entering..."),[E,k]=(0,r.useState)(!1),[P,O]=(0,r.useState)([]),[T,I]=(0,r.useState)(null),[R,D]=(0,r.useState)(!1),W=(0,n.useRouter)(),{signInAsGuest:L}=(0,N.A)(),{toast:U}=(0,j.dj)(),G=async t=>{if(t.preventDefault(),!e.trim()){U({title:"⚠️ Name Required",description:"Please enter your name to continue",variant:"destructive"});return}S(!0);try{let t=e.trim();if("auto"===t.toLowerCase()){C("\uD83E\uDD16 Creating AI game..."),console.log("\uD83D\uDE80 AUTO MODE: Creating game...");let e=await fetch("/api/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hostName:"auto"})});if(!e.ok){let t=await e.text();throw console.error("❌ Auto mode error:",t),Error("Failed to create auto game")}let t=await e.json();if(console.log("\uD83D\uDCE6 Auto mode response:",t),!t.gameId)throw Error("Invalid response: missing gameId");C("\uD83D\uDCBE Saving session..."),w.sZ.savePlayerSession(t.gameId,t.playerId,"Human Player");let a=w.sZ.getPlayerSession();console.log("✅ Session saved:",a),L("Human Player"),C("\uD83C\uDFAE Launching game..."),U({title:"\uD83E\uDD16 Auto Mode Active!",description:"Playing with AI: Rookie Bot, Strategic Sam, Aggressive Alice",duration:2e3}),setTimeout(()=>{let e="/games/".concat(t.gameId);console.log("\uD83D\uDD17 Redirecting to:",e),window.location.href=e},500)}else{C("\uD83D\uDD0D Checking for active games..."),console.log("\uD83D\uDC64 Normal login:",t);let e=await fetch("/api/players/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t})});if(!e.ok)throw Error("Login failed");let a=await e.json();if(console.log("\uD83C\uDFAF Login response:",a),I(a.profile),O(a.activeGames||[]),a.hasActiveGames&&a.activeGames.length>0){S(!1),k(!0);return}C("\uD83D\uDC64 Signing in..."),L(t),w.sZ.savePlayerName(t),C("\uD83C\uDFAF Opening dashboard..."),U({title:"\uD83C\uDF89 Welcome!",description:"Welcome to A-SPADE Online, ".concat(t,"!"),duration:2e3}),setTimeout(()=>{console.log("\uD83D\uDD17 Redirecting to dashboard..."),W.push("/dashboard")},300)}}catch(e){console.error("❌ Login error:",e),U({title:"❌ Login Failed",description:e instanceof Error?e.message:"Please try again",variant:"destructive",duration:4e3}),S(!1)}},J=async t=>{D(!0);try{let a=await fetch("/api/players/resume",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerName:e.trim(),gameId:t})}),s=await a.json();if(!s.success){U({title:"⚠️ Game Unavailable",description:s.error||"Game has ended or is no longer available",variant:"destructive"}),F();return}w.sZ.savePlayerSession(t,s.playerId,e.trim()),L(e.trim()),U({title:"\uD83C\uDFAE Game Resumed!",description:"Welcome back! Continuing your game...",duration:2e3}),setTimeout(()=>{W.push("/games/".concat(t))},500)}catch(e){console.error("❌ Resume error:",e),U({title:"❌ Resume Failed",description:"Could not resume game. Starting fresh...",variant:"destructive"}),F()}finally{D(!1)}},F=()=>{k(!1),O([]),L(e.trim()),w.sZ.savePlayerName(e.trim()),U({title:"\uD83C\uDF89 Welcome!",description:"Welcome to A-SPADE Online, ".concat(e.trim(),"!"),duration:2e3}),setTimeout(()=>{W.push("/dashboard")},300)},H=e=>{let t=Math.floor((Date.now()-e)/6e4),a=Math.floor(t/60),s=Math.floor(a/24);return s>0?"".concat(s,"d ago"):a>0?"".concat(a,"h ago"):t>0?"".concat(t,"m ago"):"Just now"},M=e=>{switch(e){case"waiting":return"bg-yellow-500";case"playing":return"bg-green-500";case"bidding":return"bg-blue-500";case"trick-tracking":return"bg-purple-500";default:return"bg-gray-500"}},Z=e=>{switch(e){case"waiting":return"Waiting for Players";case"playing":return"Game in Progress";case"bidding":return"Bidding Phase";case"trick-tracking":return"Playing Tricks";default:return e}};return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4",suppressHydrationWarning:!0,children:(0,s.jsxs)("div",{className:"w-full max-w-md space-y-6 animate-fade-in-up",suppressHydrationWarning:!0,children:[(0,s.jsxs)("div",{className:"text-center space-y-3",suppressHydrationWarning:!0,children:[(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",suppressHydrationWarning:!0,children:[(0,s.jsx)(u.A,{className:"h-8 w-8 text-amber-400 animate-pulse"}),(0,s.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent",children:"A-SPADE Online"}),(0,s.jsx)(u.A,{className:"h-8 w-8 text-amber-400 animate-pulse"})]}),(0,s.jsx)("p",{className:"text-slate-300 font-medium text-lg",children:"Mobile Spades Experience"})]}),(0,s.jsxs)(o.Zp,{className:"bg-slate-800/80 border-slate-700/50 shadow-2xl backdrop-blur-sm",suppressHydrationWarning:!0,children:[(0,s.jsxs)(o.aR,{className:"text-center pb-4",children:[(0,s.jsxs)(o.ZB,{className:"text-2xl flex items-center justify-center gap-2 text-white",children:[(0,s.jsx)(g.A,{className:"h-6 w-6 text-amber-400"}),"Welcome, Champion"]}),(0,s.jsx)(o.BT,{className:"text-slate-300 text-base",children:"Enter your name to begin your spades journey"})]}),(0,s.jsxs)(o.Wu,{className:"space-y-6",children:[(0,s.jsxs)("form",{onSubmit:G,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(c.J,{htmlFor:"name",className:"text-white font-medium",children:"Your Name"}),(0,s.jsx)(l.p,{id:"name",type:"text",placeholder:"Enter your name",value:e,onChange:e=>t(e.target.value),className:"bg-slate-700/50 border-slate-600 focus:border-amber-400 transition-colors text-center text-lg text-white placeholder:text-slate-400 h-12",maxLength:20,required:!0,disabled:a}),(0,s.jsxs)("div",{className:"bg-slate-700/30 rounded-lg p-3 text-center",children:[(0,s.jsx)("p",{className:"text-sm text-amber-400 font-medium mb-1",children:"\uD83D\uDCA1 Quick Play Mode"}),(0,s.jsx)("p",{className:"text-xs text-slate-300",children:'Type "auto" to instantly play with AI players!'})]})]}),(0,s.jsx)(i.$,{type:"submit",className:"w-full bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white font-bold text-lg h-12 hover:scale-105 transition-all duration-300 shadow-lg",disabled:a||!e.trim(),size:"lg",children:a?(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(h.A,{className:"animate-spin w-5 h-5"}),(0,s.jsx)("span",{children:A})]}):(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["auto"===e.toLowerCase()?(0,s.jsx)(p.A,{className:"w-5 h-5"}):(0,s.jsx)(x.A,{className:"w-5 h-5"}),"Continue as Guest"]})})]}),(0,s.jsx)("div",{className:"text-center text-sm text-slate-400",children:(0,s.jsx)("p",{children:"\uD83C\uDFAF Your game progress is automatically saved"})})]})]}),(0,s.jsx)(d.lG,{open:E,onOpenChange:k,children:(0,s.jsxs)(d.Cf,{className:"bg-slate-800 border-slate-700 text-white max-w-md",children:[(0,s.jsxs)(d.c7,{children:[(0,s.jsxs)(d.L3,{className:"flex items-center gap-2",children:[(0,s.jsx)(f.A,{className:"h-5 w-5 text-amber-400"}),"Welcome Back, ",e,"!"]}),(0,s.jsx)(d.rr,{className:"text-slate-300",children:1===P.length?"You have an active game. Would you like to resume?":"You have ".concat(P.length," active games. Choose one to resume or start fresh.")})]}),(0,s.jsx)("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:P.map(e=>(0,s.jsxs)("div",{className:"bg-slate-700/50 rounded-lg p-3 border border-slate-600",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h4",{className:"font-medium",children:e.title}),(0,s.jsx)(m.E,{variant:"secondary",className:"".concat(M(e.status)," text-white text-xs"),children:Z(e.status)})]}),(0,s.jsxs)("div",{className:"text-sm text-slate-300 space-y-1",children:[(0,s.jsxs)("p",{children:["Code: ",(0,s.jsx)("span",{className:"font-mono text-amber-400",children:e.gameCode})]}),(0,s.jsxs)("p",{children:["Round: ",e.currentRound,"/",e.totalRounds]}),(0,s.jsxs)("p",{children:["Players: ",e.playerCount]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,s.jsx)(y.A,{className:"h-3 w-3"}),H(e.lastActivity)]})]}),(0,s.jsx)(i.$,{size:"sm",className:"w-full mt-2 bg-green-600 hover:bg-green-700",onClick:()=>J(e.gameId),disabled:R,children:R?(0,s.jsx)(h.A,{className:"w-4 h-4 animate-spin"}):(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(b.A,{className:"w-4 h-4"}),"Resume Game"]})})]},e.gameId))}),(0,s.jsx)(d.Es,{className:"flex-col gap-2",children:(0,s.jsx)(i.$,{variant:"outline",className:"w-full border-slate-600 hover:bg-slate-700",onClick:F,disabled:R,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(v.A,{className:"w-4 h-4"}),"Start Fresh"]})})})]})})]})})}function A(){return(0,s.jsx)(S,{})}},8145:(e,t,a)=>{"use strict";a.d(t,{E:()=>o});var s=a(5155);a(2115);var r=a(2085),n=a(3999);let i=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,n.cn)(i({variant:a}),t),suppressHydrationWarning:!0,...r})}},9840:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>m,Es:()=>g,L3:()=>h,c7:()=>u,lG:()=>l,rr:()=>p});var s=a(5155),r=a(2115),n=a(8762),i=a(4416),o=a(3999);let l=n.bL;n.l9;let c=n.ZL;n.bm;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.hJ,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});d.displayName=n.hJ.displayName;let m=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(d,{}),(0,s.jsxs)(n.UC,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l,children:[r,(0,s.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(i.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=n.UC.displayName;let u=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),suppressHydrationWarning:!0,...a})};u.displayName="DialogHeader";let g=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),suppressHydrationWarning:!0,...a})};g.displayName="DialogFooter";let h=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.hE,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});h.displayName=n.hE.displayName;let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.VY,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...r})});p.displayName=n.VY.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[455,953,521,973,413,441,684,358],()=>t(310)),_N_E=e.O()}]);